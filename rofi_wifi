#!/bin/env bash

# Simple rofi Wi-Fi connector using NetworkManager (nmcli)

# Dependencies: rofi, nmcli, notify-send (optional)

# Get available networks
networks=$(nmcli -t -f SSID,SIGNAL,SECURITY dev wifi list | awk -F: '!seen[$1]++ && $1 != "" { printf "%-30s  %3s%%  %s\n", $1, $2, $3 }')

[ -z "$networks" ] && {
    notify-send "Wi-Fi" "No networks found"
    exit 1
}

# Pick network
chosen=$(echo "$networks" | rofi -dmenu -l 10 -p "Select Wi-Fi:" | awk '{print $1}')
[ -z "$chosen" ] && exit 1

# Check if already connected
if nmcli -t -f NAME con show --active | grep -Fxq "$chosen"; then
    notify-send "Wi-Fi" "Already connected to $chosen"
    exit 0
fi

# Check if it needs a password
security=$(nmcli -t -f SSID,SECURITY dev wifi list | grep -F "$chosen" | awk -F: '{print $2}' | head -n1)

if [[ "$security" == "--" || "$security" == "" ]]; then
    nmcli dev wifi connect "$chosen" && notify-send "Wi-Fi" "Connected to $chosen" && exit 0
else
    password=$(echo "" | rofi -dmenu -p "Password for $chosen:")
    [ -z "$password" ] && exit 1
    nmcli dev wifi connect "$chosen" password "$password" && notify-send "Wi-Fi" "Connected to $chosen" || notify-send "Wi-Fi" "Connection failed"
fi
